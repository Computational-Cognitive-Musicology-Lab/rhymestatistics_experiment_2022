<!DOCTYPE html>
<html>
  <head>
    <title>English Artistry Experiment</title>
    <script src="jsPsych/jspsych.js"></script>
    <script src="jsPsych/plugins/jspsych-audio-button-response.js"></script>
    <script src="jsPsych/plugins/jspsych-survey-likert.js"></script>
    <script src="jsPsych/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="jsPsych/plugins/jspsych-survey-html-form.js"></script>
    <link href="jsPsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body> </body>
  <script>
    function saveData(name, data){
      var time = Date.now();
      var date = new Date(time);
      var timestamp = date.toLocaleDateString();
      timestamp = timestamp.replaceAll('/', '-') + "_" + date.getHours() + ":" + date.getMinutes();
      console.log(timestamp);
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({filename: name + timestamp, filedata: data}));
    };

    var consent = {
      type: "html-button-response",
      stimulus:  ' <p><img src="gatechlogo.png" height="60" /> <img src="LabLogo_BlackandWhite.png" height="60" /></p> <p>Thank you for your interest in our research study. This study is intended for native speakers of English of <em>any</em> dialect—we’re afraid we can’t accept participation from anyone else. For native English speakers, your participation will help us better understand the use of language as an art form. Your participation is extremely valuable to us and we thank you for helping out!</p> <p>The study should take approximately 20–30 minutes to complete. Your participation in this study is always voluntary and you may discontinue your participation at any time.</p> <h4 id="ethics">Ethics:</h4> <p>This study has been reviewed by the Georgia Tech Institutional Review Board, and has been identified as “Minimal risk research” (Ethics ID # XXXX). The risks of participating in this study are no greater than any casual poetry listening or other other normal daily activities.</p> <h4 id="confidentiality">Confidentiality:</h4> <p>We will comply with any applicable laws and regulations regarding confidentiality. Your responses to the study questions will be entirely anonymous and confidential. No personal data will be gathered from you, and your identity will never be associated with your data, published, or disclosed in any way.</p> <p>To make sure that this research is being carried out in the proper way, the Georgia Institute of Technology IRB may review study records. The Office of Human Research Protections may also look at study records. Your anonymous responses may also be shared with other scientists for use in other research.</p> <h4 id="compensation-rights">Compensation &amp; Rights:</h4> <p>You will not benefit of be compensated for participating in this study.</p> <h4 id="contacts-and-questions">Contacts and Questions:</h4> <p>For questions, concerns, or complaints about the study, you may contact the Principal Investigator, Dr. Nathaniel Condit-Schultz at: natcs[at]gatech.edu or by telephone (404)-904-1112. If you have any questions about your rights as a research subject, you may contact Ms. Melanie Clark, Georgia Institute of Technology at (404)-894-6942.</p> <hr /> <p>Only adults (18 years or older) who speak English as a native language are eligible to participate in this study. <strong>By clicking below and completing the study you are agreeing to participate.</strong> You do <em>not</em> waive any of your legal rights by agreeing to participate.</p>'
           onclick="consentAndContinue()"></p>
'
      choices: ["I agree. Begin the study."],

    };



    var demographics = {
      type: "survey-html-form",
      preamble: "Before we begin, please tell us a little about yourself:",
      html: '<p><b>Age</b>: <input type="number" min="18" max="120" id="part_age" name="part_age"/></p>' +
            '<p><b>Gender</b>: <input type="test" id="part_age" name="part_age"/></p>'
    };
    var experience = {
      type: "survey-multi-choice",
      preamble: "<b>Next, tell us a little bit about your experiences. Complete the following statements:</b>",
      questions: [
                   //{prompt: "I consider myself a poet.", options: ["True", "False"], name: "Poet", horizontal:true, required:true},

                   {prompt: "How often do you listen to or read poetry (not including musical lyrics)?", 
                   options: ["Never", "Occassionally", "Regularly", "Frequently"],
                   horizontal: true, required:true,
                   name: "Poetry R"},
                   {prompt: "How often do you write or perform poetry (not including musical lyrics)?",
                   options: ["Never", "Occassionally", "Regularly", "Frequently"],
                   horizontal: true, required:true,
                   name: "Poetry W"},
                  {prompt: "When you listen to music, do you pay attention to the lyrics?",
                   options: ["Not at all", "Sometimes", "Usually", "Always"],
                   horizontal: true, required:true,
                   name: "Music L"},
                  {prompt: "In the music you enjoy, do you think the lyrics are essential to the artistry?",
                   options: ["Not at all", "Sometimes/maybe", "Definitely"],
                   horizontal: true, required:true,
                   name: "Music Lyrics Value"},
                  {prompt: "Do you enjoy listening to rap music?",
                   options: ["Not at all", "Occassionally", "Yes", "It is my favorite music."],
                   horizontal: true, required:true,
                   name: "Rap"},
                   {prompt: "How often do you write songs with lyrics?",
                   options: ["Never", "Occassionally", "Regularly", "Frequently"],
                   horizontal: true, required:true,
                   name: "Music W"},
                  {prompt: "How often do you sing music with lyrics?",
                   options: ["Never", "Occassionally", "Regularly", "Frequently"],
                   horizontal: true, required:true,
                   name: "Singing"},
                 ],

    };

    var instructions = {
       type: "html-button-response",
      stimulus: "<p></p>",
      choices: ["I'm ready to start the experiment."]
    };

var audiofiles = [];



    var maintrial = {
      type: "audiovolume-button-response",
      labels: ["Poetry", "Prose"],
      button_label: "Continue",
      prompt: "<p>Do you think this utterenace was originally poetry or prose?</p>",
      stimulus: jsPsych.timelineVariable("file"),
      post_trial_gap: 2000,
    };

    var mainblock = {
      timeline: [maintrial],
      timeline_variables: audio_sample_block1,
      randomize_order: false,
      }
    



    var thanks = {
      type: "html-button-response",
      stimulus:  "<p><img src='gatechlogo.png' height='120' /> <img src='LabLogo_BlackandWhite.png' height='200' /></p>" +
                  "DEBREIF HERE" + 
                  "<p>Contact Nat Condit-Schultz at natcs[at]gatech.edu if you have any questions.</p>",
      choices: ["I'm done."],
      on_start: function() {saveData("Compression_", jsPsych.data.get().json()); console.log("Finished");},
    };


var all_audiofiles = audio_sample_block1.map((item) => {return item.file});

all_audiofiles = all_audiofiles.concat(audiofiles2.map((item) => {return item.first}));
all_audiofiles = all_audiofiles.concat(audiofiles2.map((item) => {return item.second}));

all_audiofiles = _.uniq(all_audiofiles);
console.log(audio_sample_block1);
console.log(audiofiles2);

console.log(all_audiofiles);


    /* start the experiment */
    jsPsych.init({
      show_progress_bar: true,
      timeline: [consent, demographics, experience, instructions, mainblock, thanks],
      preload_audio: all_audiofiles,
    });
  </script>
</html>
